!function(t){var a={};function e(n){if(a[n])return a[n].exports;var r=a[n]={i:n,l:!1,exports:{}};return t[n].call(r.exports,r,r.exports,e),r.l=!0,r.exports}e.m=t,e.c=a,e.d=function(t,a,n){e.o(t,a)||Object.defineProperty(t,a,{enumerable:!0,get:n})},e.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},e.t=function(t,a){if(1&a&&(t=e(t)),8&a)return t;if(4&a&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(e.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&a&&"string"!=typeof t)for(var r in t)e.d(n,r,function(a){return t[a]}.bind(null,r));return n},e.n=function(t){var a=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(a,"a",a),a},e.o=function(t,a){return Object.prototype.hasOwnProperty.call(t,a)},e.p="",e(e.s=0)}([function(t,a,e){"use strict";function n(t){return{handleEvent:t}}e.r(a);const r=(t,a)=>t+a,i=["1年","2年","3年","4年","M1","M2","D"],o=new class{constructor(t){this._data=t}get data(){return this._data}update(t){return this._data={total:void 0!==t.total?t.total:this._data.total,diffParam:void 0!==t.diffParam?t.diffParam:this._data.diffParam,trancate:void 0!==t.trancate?t.trancate:this._data.trancate,counts:void 0!==t.counts?t.counts:this._data.counts},{data:this._data,result:this.isComputable(this._data)?{wasComputed:!1}:this.computePayment(this._data)}}computePayment(t){const a=t.diffParam,e=t.total,n=t.trancate,i=t.counts,o=i.reduce(r);if(0==o||0==n)return{wasComputed:!0,payments:t.counts.map(t=>0),remainder:e};const d=i.map((t,a)=>t*a).reduce(r),u=(e-a*n*d)%(o*n),s=(e-u-a*n*d)/(o*n);return{wasComputed:!0,payments:t.counts.map((t,e)=>s*n+e*a*n),remainder:u}}isComputable(t){return t.total<=0||t.trancate<=0||t.diffParam<0||t.counts.map(t=>t<0).reduce((t,a)=>t||a)}}({counts:i.map(t=>0),total:0,diffParam:0,trancate:50}),d=new class{constructor(t,a){this.gradeNames=[...t],this.payment=a}total_field(){return document.querySelector("#total_field")}max_fraction_field(){return document.querySelector("#max_fraction_field")}diff_parameter_slider(){return document.querySelector("#diff_parameter_slider")}diff_value(){return document.querySelector("#diff_value")}participants_counts_field(t){return document.querySelector("#participants_counts_field"+t)}payment_amount(t){return document.querySelector("#payment_amount"+t)}output_remainder(){return document.querySelector("#output_remainder_text")}initialize(){this.build_input_participants(),this.addEventListeners()}build_input_participants(){const t=document.querySelector("#input_participants"),a=document.querySelector("#participants_data_template");this.gradeNames.forEach((e,n)=>{const r=document.importNode(a.content,!0).querySelector("div"),i=r.querySelectorAll("div"),o=i[0];o.textContent=e,o.id="grade_name"+n,i[1].children[0].id="participants_counts_field"+n,i[2].children[0].id="payment_amount"+n,t.appendChild(r)})}addEventListeners(){const t=t=>null===t.match(/^\d{1,9}$/)?0:parseInt(t);this.total_field().addEventListener("change",n(a=>this.update({total:t(a.target.value)}))),this.max_fraction_field().addEventListener("change",n(a=>this.update({trancate:t(a.target.value)}))),this.diff_parameter_slider().addEventListener("input",n(a=>this.updateAndCompute({diffParam:t(a.target.value)}))),this.gradeNames.forEach((a,e)=>this.participants_counts_field(e).addEventListener("change",n(a=>this.updateAndCompute({counts:this.payment.data.counts.map((n,r)=>r===e?t(a.target.value):n)}))))}update(t){const a=this.validateData(t),{data:e}=this.payment.update(t);this.showData(Object.assign(e,{diffParamMax:a.diffParamMax}))}updateAndCompute(t){const a=this.validateData(t),{data:e,result:n}=this.payment.update(t);this.showData(Object.assign(e,{diffParamMax:a.diffParamMax})),this.showResult(e,n)}showData(t){this.total_field().value=t.total.toString(),this.max_fraction_field().value=t.trancate.toString(),t.counts.forEach((t,a)=>this.participants_counts_field(a).value=t.toString()),this.diff_parameter_slider().max=t.diffParamMax.toString(),this.diff_value().textContent=(t.trancate*t.diffParam).toString()}showResult(t,a){a.wasComputed&&(a.payments.forEach((a,e)=>{const n=this.payment_amount(e);t.counts[e]>0?n.textContent=a.toString():n.textContent="0"}),this.output_remainder().textContent=a.remainder.toString())}validateData(t){const a=this.payment.data,e=(void 0!==t.counts?t.counts:a.counts).map(t=>Math.max(0,t)),n=Math.max(0,void 0!==t.total?t.total:a.total),r=Math.max(1,void 0!==t.trancate?t.trancate:a.trancate),i=e.map((t,a)=>a*t).reduce((t,a)=>t+a),o=Math.floor(n/(r*i));return{total:n,counts:e,trancate:r,diffParam:Math.min(0,Math.max(o,void 0!==t.diffParam?t.diffParam:a.diffParam)),diffParamMax:o}}}(i,o);window.onload=(()=>{d.initialize(),console.log(o),console.log(d)})}]);
//# sourceMappingURL=bundle.js.map